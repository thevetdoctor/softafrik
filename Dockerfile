FROM node:18.16.0

RUN mkdir -p /app
WORKDIR /app

COPY package*.json ./

RUN npm ci

ENV SKIP_PREFLIGHT_CHECK=true

COPY . ./

ARG REACT_APP_GATEWAY_URL
ARG REACT_APP_MAIL_SERVICE_URL

ENV REACT_APP_GATEWAY_URL $REACT_APP_GATEWAY_URL
ENV REACT_APP_MAIL_SERVICE_URL $REACT_APP_MAIL_SERVICE_URL

RUN env

RUN npm run build

EXPOSE 3000

CMD ["node", "server/index.js"]
